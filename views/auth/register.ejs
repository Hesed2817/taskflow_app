<%- include('../layouts/main.ejs') -%>

    <div class="auth-container">
        <div class="auth-box">
            <!-- Logo Header -->
            <div class="auth-header">
                <a href="/" class="auth-logo">TaskFlow</a>
                <p class="auth-tagline">Join others by managing your projects efficiently</p>
            </div>

            <!-- Alert Container -->
            <% if (error) { %>
                <%= error %>
                    <% } %>

                        <% if (success) { %>
                            <div class="auth-alert auth-alert-success show">
                                <i class="fas fa-check-circle"></i>
                                <%= success %>
                            </div>
                            <% } %>

                                <h2 class="auth-title">Create Account</h2>

                                <!-- Traditional form -->
                                <form action="/api/auth/register" method="POST" class="auth-form">
                                    <div class="auth-form-group">
                                        <label for="username" class="auth-label">Username</label>
                                        <input type="text" id="username" name="username" required class="auth-input"
                                            placeholder="John Doe" autocomplete="username">
                                    </div>

                                    <div class="auth-form-group">
                                        <label for="email" class="auth-label">Email</label>
                                        <input type="email" id="email" name="email" required class="auth-input"
                                            placeholder="your@email.com" autocomplete="email">
                                    </div>

                                    <div class="auth-form-group">
                                        <label for="password" class="auth-label">Password</label>
                                        <div class="password-wrapper">
                                            <input type="password" id="password" name="password" required minlength="6"
                                                class="auth-input" placeholder="At least 6 characters"
                                                autocomplete="new-password">
                                            <button type="button" class="password-toggle"
                                                onclick="togglePasswordVisibility(this)" aria-label="Show password">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div class="password-requirements">
                                            Must be at least 6 characters long
                                        </div>
                                    </div>

                                    <!-- Confirm Password (Optional - add if needed) -->

                                    <div class="auth-form-group">
                                        <label for="confirmPassword" class="auth-label">Confirm Password</label>
                                        <div class="password-wrapper">
                                            <input type="password" id="confirmPassword" name="confirmPassword" required
                                                minlength="6" class="auth-input" placeholder="Confirm your password"
                                                autocomplete="new-password">
                                            <button type="button" class="password-toggle"
                                                onclick="togglePasswordVisibility(this)" aria-label="Show password">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div id="password-match-message" class="password-requirements"
                                            style="display: none;">
                                            Passwords do not match
                                        </div>
                                    </div>


                                    <button type="submit" class="auth-btn auth-btn-register">
                                        <i class="fas fa-user-plus"></i> Create Account
                                    </button>
                                </form>

                                <!-- Terms & Conditions (Optional) -->
                                <!-- 
        <div class="auth-terms">
            <div class="auth-checkbox">
                <input type="checkbox" id="terms" name="terms" required>
                <label for="terms">
                    I agree to the <a href="/terms" class="auth-link">Terms of Service</a> 
                    and <a href="/privacy" class="auth-link">Privacy Policy</a>
                </label>
            </div>
        </div>
        -->

                                <div class="auth-footer">
                                    Already have an account?
                                    <a href="/login" class="auth-link">Login here</a>
                                </div>
        </div>
    </div>

    <script src="/js/password-toggle.js"></script>
    <!-- Add loading state for form -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.querySelector('.auth-form');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');

            if (form) {
                form.addEventListener('submit', function (e) {
                    if (passwordInput && confirmPasswordInput) {
                        if (passwordInput.value !== confirmPasswordInput.value) {
                            e.preventDefault();
                            alert('Passwords do not match!');
                            confirmPasswordInput.focus();
                            return;
                        }
                    }

                    const submitBtn = this.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account...';
                    }
                });
            }

            // Password validation
            if (passwordInput && confirmPasswordInput) {
                const matchMessage = document.getElementById('password-match-message');

                const validatePasswords = () => {
                    if (confirmPasswordInput.value === '') {
                        matchMessage.style.display = 'none';
                        return;
                    }

                    matchMessage.style.display = 'block';
                    if (passwordInput.value === confirmPasswordInput.value) {
                        matchMessage.textContent = 'Passwords match';
                        matchMessage.style.color = 'var(--color-success)';
                    } else {
                        matchMessage.textContent = 'Passwords do not match';
                        matchMessage.style.color = 'var(--color-danger)';
                    }
                };

                passwordInput.addEventListener('input', function () {
                    const requirements = this.closest('.auth-form-group').querySelector('.password-requirements');
                    if (this.value.length < 6) {
                        requirements.style.color = 'var(--color-danger)';
                    } else {
                        requirements.style.color = 'var(--color-success)';
                    }
                    validatePasswords();
                });

                confirmPasswordInput.addEventListener('input', validatePasswords);
            }

            // Theme toggle for auth pages (since no header)
            const themeToggle = document.createElement('button');
            themeToggle.className = 'theme-toggle auth-theme-toggle';
            themeToggle.innerHTML = '<i class="fas fa-moon"></i><i class="fas fa-sun"></i>';
            themeToggle.setAttribute('title', 'Toggle dark mode');
            themeToggle.style.position = 'fixed';
            themeToggle.style.backgroundColor = 'var(--color-primary)';
            themeToggle.style.top = '20px';
            themeToggle.style.right = '20px';
            themeToggle.style.zIndex = '100';
            themeToggle.onclick = function () {
                const currentTheme = localStorage.getItem('theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                localStorage.setItem('theme', newTheme);
                document.documentElement.setAttribute('data-theme', newTheme);
            };

            // Add theme toggle if not already in header
            if (!document.querySelector('.header')) {
                document.body.appendChild(themeToggle);
            }
        });
    </script>